{"version":3,"sources":["../src/index.js"],"names":["cluster","isMaster","cpuCount","require","cpus","length","i","fork","on","worker","console","log","id","app","port","process","env","PORT","router","express","Router","use","stream","logger","listen"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEA,IAAIA,kBAAQC,QAAZ,EAAqB;AACjB,QAAIC,WAAWC,QAAQ,IAAR,EAAcC,IAAd,GAAqBC,MAApC;AACA,SAAI,IAAIC,IAAE,CAAV,EAAaA,IAAIJ,QAAjB,EAA2BI,GAA3B,EAA+B;AAC3BN,0BAAQO,IAAR;AACH;AACDP,sBAAQQ,EAAR,CAAW,MAAX,EAAmB,UAACC,MAAD,EAAY;AAC3BC,gBAAQC,GAAR,aAAsBF,OAAOG,EAA7B;AACAZ,0BAAQO,IAAR;AACH,KAHD;AAIH,CATD,MASO;AACH,QAAMM,MAAM,wBAAZ;AACA,QAAMC,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC;AACA,QAAMC,SAASC,kBAAQC,MAAR,EAAf;;AAEAP,QAAIQ,GAAJ,CAAQ,MAAR,EAAgBH,MAAhB;AACAL,QAAIQ,GAAJ,CAAQ,sBAAO,UAAP,EAAmB,EAAEC,QAAQC,kBAAOD,MAAjB,EAAnB,CAAR;AACHT,QAAIW,MAAJ,CAAWV,IAAX,EAAiB;AAAA,eAAMJ,QAAQC,GAAR,aAAsBX,kBAAQS,MAAR,CAAeG,EAArC,eAAN;AAAA,KAAjB;;AAEG,0BAAOM,MAAP;AACH","file":"index.js","sourcesContent":["import cluster from 'cluster';\nimport express from 'express';\nimport routes from './routes';\nimport 'babel-polyfill';\nimport morgan from 'morgan';\nimport logger from './config/winston';\n\nif (cluster.isMaster){\n    let cpuCount = require('os').cpus().length\n    for(let i=0; i < cpuCount; i++){\n        cluster.fork();\n    }\n    cluster.on('exit', (worker) => {\n        console.log(`Worker ${worker.id} died`);\n        cluster.fork();\n    })\n} else {\n    const app = express();\n    const port = process.env.PORT || 8080\n    const router = express.Router();\n\n    app.use('/api', router);\n    app.use(morgan('combined', { stream: logger.stream }));\n\tapp.listen(port, () => console.log(`Worker ${cluster.worker.id} running!`));\n\n    routes(router)\n}"]}